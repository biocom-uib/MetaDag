# Data statistics

```{r setup_data_statistics, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,warning =FALSE,cache=FALSE,echo=FALSE,messages=FALSE)
library(tidyverse)
library(dplyr)
library(ComplexHeatmap)
library(viridis)
library(circlize)
library(plotly)
library(randomcoloR)
library(knitr)
#library(kableExtra)
library(factoextra)
library(RColorBrewer)
```

# Data analysis whit 4 methods distance Direct, Munkrest, Direct_Munkrest and Munkrest_Direct

# Load meta data from experimet all eukariotes

Meta data mDa_Id and taxonomy sort by Kingdom,Filum,Class,mDAG_Id

```{r}
experiment="result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf"
path=paste0("data/result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf","/data/")
path

setwd("data/result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf/data/Individuals/")

results=read_csv(paste0(path,"Results.csv"))
names(results)[c(1,3)]=c("Organism","mDAG_Id")
#code=results %>% select(Organism:mDAG_Id)
taxo=results %>% select(Organism:`Full Name`) %>% separate(Categories,c("Kingdom","Filum","Class"),"[|]")
#order_class=order(table(taxo$Class),decreasing = TRUE)
#table(is.na(taxo$Class))
meta_taxo= taxo %>% 
  right_join(code,by="Organism") %>%
  arrange(Kingdom,Filum,Class,mDAG_Id)
index=which(is.na(meta_taxo$Class))
meta_taxo$Class[index]=meta_taxo$Filum[index]
table(meta_taxo$Domain) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "200px", height = "100px")
table(meta_taxo$Kingdom) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "400px", height = "200px")
table(taxo$Filum,taxo$Class) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")
```

# Distances for method Direct and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the direct method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_DirectedMethod<-read_csv(
  "data/result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf/data/Similarities_MBB_MSAMethod.csv")
names(dis_DirectedMethod)[1]="mDAG_Id"
dis_DirectedMethod[,-1]=sqrt(1-dis_DirectedMethod[,-1])
dis_DirectedMethod_meta =dis_DirectedMethod %>% right_join(select(taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>%
  arrange(Kingdom,Filum,Class)



ID=dis_DirectedMethod_meta$mDAG_Id
dis_DirectedMethod=  dis_DirectedMethod_meta %>% 
  select(-Kingdom) %>% 
  relocate(mDAG_Id,ID) %>%
  select(2:570) %>%
  as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_DirectedMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_DirectedMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

#colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

#anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_DirectedMethod, 
                          column_title="Distance mDag Direct Method\n  Eukaritas by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
    at = c(0.4,0.5,0.6,0.7,0.8,0.9,1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_animals= meta_taxo %>% filter(Kingdom=="Animals")
nombres=unique(meta_animals$Filum)
aux_order=table(meta_animals$Filum)
dff<-dis_DirectedMethod_meta %>% filter(Kingdom=="Animals") %>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
"Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))
colores
aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_DirectedMethod[1:268,1:268], 
              column_title="Distance mDag Direct Method\n  Animals by Class",
            name = "Class", 
            heatmap_legend_param = list(
    at = seq(0,1.5,by=0.1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)-> aux
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_DirectedMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
 # mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(33)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
plot_ly(
  mds, x = ~Dim.1, y = ~Dim.2,
  color = ~groups, 
  colors= col_mds
) %>%
  layout(
    xaxis = list(autorange=2,
      range=c(-0.8,0.8)), yaxis = list(autorange=2,
      range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_DirectedMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_DirectedMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_DirectedMethod_meta=dis_DirectedMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_DirectedMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
 scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_DirectedMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_DirectedMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Distances for Munkrest method and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the direct method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_MunkrestMethod<-read_csv("data/Distances_mDAG_MunkrestMethod.csv")
names(dis_MunkrestMethod)[1]="mDAG_Id"

dis_MunkrestMethod_meta =dis_MunkrestMethod %>% right_join(select(meta_taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>% arrange(Kingdom,Filum,Class)

ID=dis_DirectedMethod_meta$mDAG_Id
dis_MunkrestMethod=  dis_MunkrestMethod_meta %>% select(-Kingdom) %>% relocate(mDAG_Id,ID) %>% select(2:570) %>% as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_MunkrestMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_MunkrestMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_MunkrestMethod, 
                          column_title="Distance mDag Munkrest Method\n  Eurokaritas by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
    at = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_vert= meta_taxo %>% filter(Kingdom=="Animals")

nombres=unique(meta_vert$Filum)

dff<-dis_MunkrestMethod_meta %>% filter(Kingdom=="Animals")%>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
"Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))

aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_MunkrestMethod[1:268,1:268], 
              column_title="Distance mDag Munkrest Method\n  Animals by Class",
            name = "Class", 
            heatmap_legend_param = list(
    at = seq(0,1.5,by=0.1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_MunkrestMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
 # mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(4)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
plot_ly(
  mds, x = ~Dim.1, y = ~Dim.2,
  color = ~groups, 
  colors= col_mds
) %>%
  layout(
    xaxis = list(autorange=2,
      range=c(-0.8,0.8)), yaxis = list(autorange=2,
      range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_MunkrestMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_MunkrestMethod_meta=dis_MunkrestMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_MunkrestMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
 scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_MunkrestMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Distances for Direct_Munkrest method and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the Direct_Munkrest method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_DirectMethod_MunkrestMethod<-
  read_csv("data/Distances_mDAG_DirectMethod_MunkrestMethod.csv")
names(dis_DirectMethod_MunkrestMethod)[1]="mDAG_Id"

dis_DirectMethod_MunkrestMethod_meta =dis_DirectMethod_MunkrestMethod %>% right_join(select(meta_taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>% arrange(Kingdom,Filum,Class)

ID=dis_DirectedMethod_meta$mDAG_Id
dis_DirectMethod_MunkrestMethod=  dis_DirectMethod_MunkrestMethod_meta %>% select(-Kingdom) %>% relocate(mDAG_Id,ID) %>% select(2:570) %>% as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_DirectMethod_MunkrestMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_DirectMethod_MunkrestMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_DirectMethod_MunkrestMethod, 
             column_title="Distance mDag  Direct_Munkrest Method Method\n  Eukaryota by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
              at = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)),
            col=rev(viridis(256)),
            cluster_rows = FALSE,
            cluster_columns = FALSE,
            top_annotation = anotacion,
            show_column_names = FALSE, 
            show_row_names = FALSE,
            left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_vert= meta_taxo %>% filter(Kingdom=="Animals")

nombres=unique(meta_vert$Filum)

dff<-dis_DirectMethod_MunkrestMethod_meta %>% filter(Kingdom=="Animals")%>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
  "Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))

aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_DirectMethod_MunkrestMethod[1:268,1:268], 
             column_title="Distance mDag  Direct_Munkrest Method Method\n  Animals by Class",
             name = "Class", 
             heatmap_legend_param = list(
               at = seq(0,1.5,by=0.1)),
             col=rev(viridis(256)),
             cluster_rows = FALSE,
             cluster_columns = FALSE,
             top_annotation = anotacion,
             show_column_names = FALSE, 
             show_row_names = FALSE,
             left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_DirectMethod_MunkrestMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
# mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(33)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
  plot_ly(
    mds, x = ~Dim.1, y = ~Dim.2,
    color = ~groups, 
    colors= col_mds
  ) %>%
  layout(
    xaxis = list(autorange=2,
                 range=c(-0.8,0.8)), yaxis = list(autorange=2,
                                                  range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_DirectMethod_MunkrestMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_DirectMethod_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_DirectMethod_MunkrestMethod_meta=dis_DirectMethod_MunkrestMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_DirectMethod_MunkrestMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
  scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_DirectMethod_MunkrestMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_DirectMethod_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Distances for Munkrest_Direct method and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the Munkrest_Direct method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_MunkrestMethod_DirectMethod<-
  read_csv("data/Distances_mDAG_MunkrestMethod_DirectMethod.csv")
names(dis_MunkrestMethod_DirectMethod)[1]="mDAG_Id"

dis_MunkrestMethod_DirectMethod_meta =dis_MunkrestMethod_DirectMethod %>% right_join(select(meta_taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>% arrange(Kingdom,Filum,Class)

ID=dis_DirectedMethod_meta$mDAG_Id
dis_MunkrestMethod_DirectMethod=  dis_MunkrestMethod_DirectMethod_meta %>% select(-Kingdom) %>% relocate(mDAG_Id,ID) %>% select(2:570) %>% as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_MunkrestMethod_DirectMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_MunkrestMethod_DirectMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_MunkrestMethod_DirectMethod, 
            column_title="Distance mDag Munkrest_Direct Method\n  Eukaryote by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
              at = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)),
            col=rev(viridis(256)),
            cluster_rows = FALSE,
            cluster_columns = FALSE,
            top_annotation = anotacion,
            show_column_names = FALSE, 
            show_row_names = FALSE,
            left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_vert= meta_taxo %>% filter(Kingdom=="Animals")

nombres=unique(meta_vert$Filum)

dff<-dis_MunkrestMethod_DirectMethod_meta %>% filter(Kingdom=="Animals")%>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
  "Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))

aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_MunkrestMethod_DirectMethod[1:268,1:268], 
             column_title="Distance mDag Munkrest_Direct Method\n  Animals by Class",
             name = "Class", 
             heatmap_legend_param = list(
               at = seq(0,1.5,by=0.1)),
             col=rev(viridis(256)),
             cluster_rows = FALSE,
             cluster_columns = FALSE,
             top_annotation = anotacion,
             show_column_names = FALSE, 
             show_row_names = FALSE,
             left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_MunkrestMethod_DirectMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
# mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(33)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
  plot_ly(
    mds, x = ~Dim.1, y = ~Dim.2,
    color = ~groups, 
    colors= col_mds
  ) %>%
  layout(
    xaxis = list(autorange=2,
                 range=c(-0.8,0.8)), yaxis = list(autorange=2,
                                                  range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_MunkrestMethod_DirectMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_MunkrestMethod_DirectMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_MunkrestMethod_DirectMethod_meta=dis_MunkrestMethod_DirectMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_MunkrestMethod_DirectMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
  scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_MunkrestMethod_DirectMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_MunkrestMethod_DirectMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Save all distancies object, and meta_taxo

```{r save_4_dis,echo=TRUE}
four_dis=save(meta_taxo,dis_DirectedMethod,
              dis_MunkrestMethod,
              dis_DirectMethod_MunkrestMethod,
              dis_MunkrestMethod_DirectMethod,file="four_dist_meta_taxo.Robj")
```

======= \# Data statistics

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,warning =FALSE,cache=FALSE,echo=FALSE,messages=FALSE)
library(tidyverse)
library(dplyr)
library(ComplexHeatmap)
library(viridis)
library(circlize)
library(plotly)
library(randomcoloR)
library(knitr)
#library(kableExtra)
library(factoextra)
library(RColorBrewer)
```

# Data analysis whit 4 methods distance Direct, Munkrest, Direct_Munkrest and Munkrest_Direct

# Load meta data from experimet all eukariotes

Meta data mDa_Id and taxonomy sort by Kingdom,Filum,Class,mDAG_Id

```{r}
experiment="result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf"
path=paste0("data/result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf","/data/")
path

setwd("data/result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf/data/Individuals/")

results=read_csv(paste0(path,"Results.csv"))
names(results)[c(1,3)]=c("Organism","mDAG_Id")
#code=results %>% select(Organism:mDAG_Id)
taxo=results %>% select(Organism:`Full Name`) %>% separate(Categories,c("Kingdom","Filum","Class"),"[|]")
#order_class=order(table(taxo$Class),decreasing = TRUE)
#table(is.na(taxo$Class))
meta_taxo= taxo %>% 
  right_join(code,by="Organism") %>%
  arrange(Kingdom,Filum,Class,mDAG_Id)
index=which(is.na(meta_taxo$Class))
meta_taxo$Class[index]=meta_taxo$Filum[index]
table(meta_taxo$Domain) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "200px", height = "100px")
table(meta_taxo$Kingdom) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "400px", height = "200px")
table(taxo$Filum,taxo$Class) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")
```

# Distances for method Direct and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the direct method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_DirectedMethod<-read_csv(
  "data/result_9ed945b7-6fd7-30de-80a3-01b4e8528ebf/data/Similarities_MBB_MSAMethod.csv")
names(dis_DirectedMethod)[1]="mDAG_Id"
dis_DirectedMethod[,-1]=sqrt(1-dis_DirectedMethod[,-1])
dis_DirectedMethod_meta =dis_DirectedMethod %>% right_join(select(taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>%
  arrange(Kingdom,Filum,Class)



ID=dis_DirectedMethod_meta$mDAG_Id
dis_DirectedMethod=  dis_DirectedMethod_meta %>% 
  select(-Kingdom) %>% 
  relocate(mDAG_Id,ID) %>%
  select(2:570) %>%
  as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_DirectedMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_DirectedMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

#colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

#anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_DirectedMethod, 
                          column_title="Distance mDag Direct Method\n  Eukaritas by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
    at = c(0.4,0.5,0.6,0.7,0.8,0.9,1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_animals= meta_taxo %>% filter(Kingdom=="Animals")
nombres=unique(meta_animals$Filum)
aux_order=table(meta_animals$Filum)
dff<-dis_DirectedMethod_meta %>% filter(Kingdom=="Animals") %>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
"Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))
colores
aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_DirectedMethod[1:268,1:268], 
              column_title="Distance mDag Direct Method\n  Animals by Class",
            name = "Class", 
            heatmap_legend_param = list(
    at = seq(0,1.5,by=0.1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)-> aux
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_DirectedMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
 # mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(33)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
plot_ly(
  mds, x = ~Dim.1, y = ~Dim.2,
  color = ~groups, 
  colors= col_mds
) %>%
  layout(
    xaxis = list(autorange=2,
      range=c(-0.8,0.8)), yaxis = list(autorange=2,
      range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_DirectedMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_DirectedMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_DirectedMethod_meta=dis_DirectedMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_DirectedMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
 scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_DirectedMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_DirectedMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Distances for Munkrest method and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the direct method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_MunkrestMethod<-read_csv("data/Distances_mDAG_MunkrestMethod.csv")
names(dis_MunkrestMethod)[1]="mDAG_Id"

dis_MunkrestMethod_meta =dis_MunkrestMethod %>% right_join(select(meta_taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>% arrange(Kingdom,Filum,Class)

ID=dis_DirectedMethod_meta$mDAG_Id
dis_MunkrestMethod=  dis_MunkrestMethod_meta %>% select(-Kingdom) %>% relocate(mDAG_Id,ID) %>% select(2:570) %>% as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_MunkrestMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_MunkrestMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_MunkrestMethod, 
                          column_title="Distance mDag Munkrest Method\n  Eurokaritas by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
    at = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_vert= meta_taxo %>% filter(Kingdom=="Animals")

nombres=unique(meta_vert$Filum)

dff<-dis_MunkrestMethod_meta %>% filter(Kingdom=="Animals")%>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
"Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))

aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_MunkrestMethod[1:268,1:268], 
              column_title="Distance mDag Munkrest Method\n  Animals by Class",
            name = "Class", 
            heatmap_legend_param = list(
    at = seq(0,1.5,by=0.1)),
        col=rev(viridis(256)),
        cluster_rows = FALSE,
        cluster_columns = FALSE,
        top_annotation = anotacion,
        show_column_names = FALSE, 
        show_row_names = FALSE,
        left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))
  
draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_MunkrestMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
 # mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(4)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
plot_ly(
  mds, x = ~Dim.1, y = ~Dim.2,
  color = ~groups, 
  colors= col_mds
) %>%
  layout(
    xaxis = list(autorange=2,
      range=c(-0.8,0.8)), yaxis = list(autorange=2,
      range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_MunkrestMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_MunkrestMethod_meta=dis_MunkrestMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_MunkrestMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
 scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_MunkrestMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
 scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Distances for Direct_Munkrest method and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the Direct_Munkrest method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_DirectMethod_MunkrestMethod<-
  read_csv("data/Distances_mDAG_DirectMethod_MunkrestMethod.csv")
names(dis_DirectMethod_MunkrestMethod)[1]="mDAG_Id"

dis_DirectMethod_MunkrestMethod_meta =dis_DirectMethod_MunkrestMethod %>% right_join(select(meta_taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>% arrange(Kingdom,Filum,Class)

ID=dis_DirectedMethod_meta$mDAG_Id
dis_DirectMethod_MunkrestMethod=  dis_DirectMethod_MunkrestMethod_meta %>% select(-Kingdom) %>% relocate(mDAG_Id,ID) %>% select(2:570) %>% as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_DirectMethod_MunkrestMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_DirectMethod_MunkrestMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_DirectMethod_MunkrestMethod, 
             column_title="Distance mDag  Direct_Munkrest Method Method\n  Eukaryota by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
              at = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)),
            col=rev(viridis(256)),
            cluster_rows = FALSE,
            cluster_columns = FALSE,
            top_annotation = anotacion,
            show_column_names = FALSE, 
            show_row_names = FALSE,
            left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_vert= meta_taxo %>% filter(Kingdom=="Animals")

nombres=unique(meta_vert$Filum)

dff<-dis_DirectMethod_MunkrestMethod_meta %>% filter(Kingdom=="Animals")%>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
  "Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))

aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_DirectMethod_MunkrestMethod[1:268,1:268], 
             column_title="Distance mDag  Direct_Munkrest Method Method\n  Animals by Class",
             name = "Class", 
             heatmap_legend_param = list(
               at = seq(0,1.5,by=0.1)),
             col=rev(viridis(256)),
             cluster_rows = FALSE,
             cluster_columns = FALSE,
             top_annotation = anotacion,
             show_column_names = FALSE, 
             show_row_names = FALSE,
             left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_DirectMethod_MunkrestMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
# mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(33)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
  plot_ly(
    mds, x = ~Dim.1, y = ~Dim.2,
    color = ~groups, 
    colors= col_mds
  ) %>%
  layout(
    xaxis = list(autorange=2,
                 range=c(-0.8,0.8)), yaxis = list(autorange=2,
                                                  range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_DirectMethod_MunkrestMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_DirectMethod_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_DirectMethod_MunkrestMethod_meta=dis_DirectMethod_MunkrestMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_DirectMethod_MunkrestMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
  scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_DirectMethod_MunkrestMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_DirectMethod_MunkrestMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Distances for Munkrest_Direct method and reordered by Kingdom,Filum,Class,mDAG_Id

In this section show the distance use the Munkrest_Direct method.

The experiment data set consists of 506 eurkaryotes from the animal, plant, fungus, and protist kingdoms.

```{r}
dis_MunkrestMethod_DirectMethod<-
  read_csv("data/Distances_mDAG_MunkrestMethod_DirectMethod.csv")
names(dis_MunkrestMethod_DirectMethod)[1]="mDAG_Id"

dis_MunkrestMethod_DirectMethod_meta =dis_MunkrestMethod_DirectMethod %>% right_join(select(meta_taxo,mDAG_Id,Kingdom,Filum,Class),by="mDAG_Id") %>% arrange(Kingdom,Filum,Class)

ID=dis_DirectedMethod_meta$mDAG_Id
dis_MunkrestMethod_DirectMethod=  dis_MunkrestMethod_DirectMethod_meta %>% select(-Kingdom) %>% relocate(mDAG_Id,ID) %>% select(2:570) %>% as.matrix()
#dis_dir=as.matrix(sqrt(2*(1-sim0[,c(2:570)]^2)))
dimnames(dis_MunkrestMethod_DirectMethod) = list(ID,ID)
```

## Heatmap

```{r, fig.align='center', fig.height=5, cache=TRUE}
dff<-dis_MunkrestMethod_DirectMethod_meta %>% select(Kingdom)  %>% as.data.frame()
#str(dff)

colores <- list(Kingdom= c("Animals"="purple","Plants"="green","Fungi"="yellow","Protists"="coral"))

anotacion <- HeatmapAnnotation(df=dff, col = colores)


a<- Heatmap(matrix = dis_MunkrestMethod_DirectMethod, 
            column_title="Distance mDag Munkrest_Direct Method\n  Eukaryote by Kingdom",
            name = "Kingdom",
            heatmap_legend_param = list(
              at = c(0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8,0.9,1)),
            col=rev(viridis(256)),
            cluster_rows = FALSE,
            cluster_columns = FALSE,
            top_annotation = anotacion,
            show_column_names = FALSE, 
            show_row_names = FALSE,
            left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a, merge_legend = TRUE)
```

```{r, fig.align='center', fig.height=5, cache=TRUE}
meta_vert= meta_taxo %>% filter(Kingdom=="Animals")

nombres=unique(meta_vert$Filum)

dff<-dis_MunkrestMethod_DirectMethod_meta %>% filter(Kingdom=="Animals")%>% select(Class) %>% as.data.frame()
#str(dff)
nombres=unique(dff$Class)
col=rainbow(length(nombres))

#paste0(paste0('"',nombres,'"="',col,'"'),collapse=",")
colores <- list(Class=c(
  "Annelids"="#FF0000","Chelicerates"="#FF4900","Crustaceans"="#FF9200","Insects"="#FFDB00","Ascidians"="#DBFF00","Brachiopodas"="#92FF00","Cnidarians"="#49FF00","Echinoderms"="#00FF00","Flatworms"="#00FF49","Hemichordates"="#00FF92","Lancelets"="#00FFDB","Mollusks"="#00DBFF","Nematodes"="#0092FF","Placozoans"="#0049FF","Poriferans"="#0000FF","Amphibians"="#4900FF","Birds"="#9200FF","Cartilaginous fishes"="#DB00FF","Fishes"="#FF00DB","Mammals"="#FF0092","Reptiles"="#FF0049"))

aux=names(colores$Class)
colores$Class=as.character(palette.colors(n=21,palette="Polychrome 36"))
attr(colores$Class,"names")=aux


anotacion <- HeatmapAnnotation(df=dff, col = colores)


a2<- Heatmap(matrix = dis_MunkrestMethod_DirectMethod[1:268,1:268], 
             column_title="Distance mDag Munkrest_Direct Method\n  Animals by Class",
             name = "Class", 
             heatmap_legend_param = list(
               at = seq(0,1.5,by=0.1)),
             col=rev(viridis(256)),
             cluster_rows = FALSE,
             cluster_columns = FALSE,
             top_annotation = anotacion,
             show_column_names = FALSE, 
             show_row_names = FALSE,
             left_annotation = rowAnnotation(df = dff, col = colores,show_annotation_name=FALSE))

draw(a2, merge_legend = TRUE)

```

```{r}
table(meta_taxo$Filum,meta_taxo$Kingdom)
```

## MDS (Multidimensional Scaling)

```{r, fig.align='center', fig.height=5, cache=TRUE}

## Metric multidimensional scaling (mMDS)
mds <- as.matrix(dis_MunkrestMethod_DirectMethod) %>%
  cmdscale() %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

summary(mds)
#cmdscale(D,2,eig=TRUE)$GOF

# Plot MDS

#mds <- mds %>%
# mutate(groups =as.factor(sim0_meta$Kingdom))

mds <- mds %>%
  mutate(groups =as.factor(meta_taxo$Kingdom))


#,text= ~paste("Age:", groups, '<br>Name:')
length(unique(meta_taxo$Filum))

#col_mds=c("purple","green","yellow","coral")
col_mds=rainbow(33)
#mcol_mds=bremer.pal(7,"Greens")

fig <- 
  plot_ly(
    mds, x = ~Dim.1, y = ~Dim.2,
    color = ~groups, 
    colors= col_mds
  ) %>%
  layout(
    xaxis = list(autorange=2,
                 range=c(-0.8,0.8)), yaxis = list(autorange=2,
                                                  range=c(-0.8,0.8)))


fig

```

## k-Means clustering 4 cluster

```{r, message=FALSE, warning=FALSE, cache=TRUE}
D2 <- dis_MunkrestMethod_DirectMethod
#names(D2)=sim0_meta$Kingdom
#row.names(D2)=sim0_meta$Kingdom
kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)


table(dis_MunkrestMethod_DirectMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Real group", "Cluster")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")



plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)

```

## Organisms classified within cluster 1 to 4

```{r, comment=NA}
dis_MunkrestMethod_DirectMethod_meta=dis_MunkrestMethod_DirectMethod_meta %>% 
  mutate(clusters= kmeans_clusters$cluster)
```

```{r}
aux= dis_MunkrestMethod_DirectMethod_meta %>% select(mDAG_Id,Kingdom,clusters) %>% inner_join(meta_taxo,"mDAG_Id")

aux %>% 
  kable %>%
  kable_styling("striped", full_width = F)%>% 
  scroll_box(width = "1000px", height = "200px")
```

## Optimal number of clusters

```{r, message=FALSE, warning=FALSE}
#set.seed(92021)
fviz_nbclust(D2, kmeans, method = "wss")

kmeans_clusters <- kmeans(x = D2, centers = 4, nstart = 50)

kminit <- sample(1:nrow(dis_MunkrestMethod_DirectMethod), 4)

kmedoids_clusters <- kmed::fastkmed(D2, ncluster = 4, iterate = 50, init = kminit)

table(dis_MunkrestMethod_DirectMethod_meta$Kingdom, kmeans_clusters$cluster, dnn=list("Kingdom", " kmeans")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")
table(dis_DirectedMethod_meta$Kingdom, kmedoids_clusters$cluster, dnn=list("Kingdom", "Cluster medioid")) %>% kable %>%
  kable_styling("striped", full_width = F,position="left")%>% 
  scroll_box(width = "500px", height = "500px")

```

```{r, message=FALSE, warning=FALSE}

plot_clust <- plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmeans_clusters$cluster], pch=21,main="Proyection MDS  cluster kmeans")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)


plot(mds$Dim.1,mds$Dim.2,xlab="dim1" ,ylab="dim2",    bg=palette()[2:5][kmedoids_clusters$cluster], pch=21,main="Proyection MDS  cluster kmedoids")
legend("topleft",legend=paste("Cluster",1:4),col=palette()[2:5],pch=21,cex=0.8)
```

# Save all distancies object, and meta_taxo

```{r save_4_dis,echo=TRUE}
four_dis=save(meta_taxo,dis_DirectedMethod,
              dis_MunkrestMethod,
              dis_DirectMethod_MunkrestMethod,
              dis_MunkrestMethod_DirectMethod,file="four_dist_meta_taxo.Robj")
```
